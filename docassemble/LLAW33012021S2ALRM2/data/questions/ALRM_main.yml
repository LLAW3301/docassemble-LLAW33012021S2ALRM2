---
include:
  - ALRM_questions.yml
  - ALRM_services_data.yml
---
mandatory: True
code: |
  ALRMdisplay_welcome_screen
  
  ALRMdisplay_final_screen
---
code: |
  ALRMdisplay_welcome_screen = True
  force_ask('ALRMwelcome_screen')
---
event: ALRMwelcome_screen
question: Welcome
subquestion: |
    Welcome to the Criminal Service Providers ('CPS') Connect Application.
    Hi this is to test
buttons:
  - I want to continue: continue
  - I do not want to continue: exit
    url: https://alrm.org.au/
---
event: ALRMdisplay_final_screen
question: Here is a list of your services
subquestion: |
  Thankyou for completing CSP connect
  
  
  Question|Answer
  ---|---
  Client intials|${ALRMinitals}
  Age|${ALRMage}
  Gender|${ALRMgender}
  Category|${ALRMkeyterm.true_values()}
  Locations Selected|${ALRMlocation.true_values()}
  
     
  The referal for ${ALRMinitals} 
  
  
  ${ALRMselected_services_table}

 
attachment:
  docx template file: ALRM_referral.docx
  valid formats:
  - pdf
  - docx
  
buttons:
  - Restart: restart
  - Exit: exit
    url: https://alrm.org.au/
---
table: ALRMselected_services_table
rows: ALRMselected_services
columns:
  - Organisation: |
      row_item['organisation']
  - Service: |
      row_item['service']
  - Website: |
      row_item['website']
  - Phone: |
      row_item['phone']
  - Email: |
      row_item['email']  
  - Address: |
      row_item['address']
  - Age Range: |
      'From {} to {}'.format(row_item['min_age'], row_item['max_age'])
  - Gender: |
      row_item['gender']

---
code: |
  ALRMselected_services = []
  for ALRMa_service in ALRMservices:
    # Criteria tests
    if ALRMa_service['min_age'] <= ALRMage <= ALRMa_service['max_age']:
      ALRMage_ok = True
    else:
      ALRMage_ok = False
      
    # Gender
    if ALRMgender in ALRMa_service['gender']:
      ALRMgender_ok = True
    else:
      ALRMgender_ok = False
     
    # keyterm
    ALRMkeyterm_ok = False
    for ALRMa_keyterm in ALRMkeyterm.true_values():
      if ALRMa_keyterm in ALRMa_service['keyterm']:
        ALRMkeyterm_ok = True

    # Location
    ALRMlocation_ok = False
    for ALRMa_location in ALRMlocation.true_values():
      if ALRMa_location in ALRMa_service['location']:
        ALRMlocation_ok = True
      
    # Eligibility test
    if ALRMage_ok and ALRMgender_ok and ALRMkeyterm_ok and ALRMlocation_ok:
      ALRMselected_services.append(ALRMa_service)
---